<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>知乎登录特效</title>
        <style>
            #canvas {
                position: absolute;
                left: 0;
                right: 0;
                bottom: 0;
                top: 0;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas" style="width: 100%; height: 100%"></canvas>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                let canvas = document.getElementById('canvas')
                let ctx = canvas.getContext('2d')

                canvas.width = document.documentElement.clientWidth
                canvas.height = document.documentElement.clientHeight

                // ctx.fillStyle = "rgba(204,218,175,0.5)";
                ctx.fillStyle = 'rgba(0, 0, 0, 0.08)'
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.05)'
                ctx.lineWidth = 0.5

                let colors = [
                    'rgba(168,227,223,0.7)',
                    'rgba(239,181,198,0.7)',
                    'rgba(248,218,153,0.7)',
                    'rgba(183,196,214,0.7)',
                    'rgba(204,218,175,0.7)'
                ]

                // 存放所有圆的数组，这里用balls
                let balls = []
                function createBall() {
                    // 随机颜色
                    let r = Math.floor(Math.random() * 5)
                    let fillColor = colors[r]

                    // x坐标
                    let _x = Math.random() * canvas.width
                    // y坐标
                    let _y = Math.random() * canvas.height
                    // 半径 [0.01, 15.01]
                    let _r = Math.random() * 10 + 0.01
                    // 水平速度 [±0.0, ±0.5]
                    let _vx = Math.random() * 0.5 * Math.pow(-1, Math.floor(Math.random() * 2 + 1))
                    // 垂直速度 [±0.0, ±0.5]
                    let _vy = Math.random() * 0.5 * Math.pow(-1, Math.floor(Math.random() * 2 + 1))
                    // 把每一个圆的信息存放到数组中
                    balls.push({
                        x: _x,
                        y: _y,
                        r: _r,
                        vx: _vx,
                        vy: _vy,
                        fillColor: fillColor
                    })
                }

                // 圆的数量
                let num = 20
                for (let i = 0; i < num; i++) {
                    createBall()
                }

                // 两点之间距离计算函数
                function distance(point1, point2) {
                    return Math.sqrt(
                        Math.pow(point1.x - point2.x, 2) + Math.pow(point1.y - point2.y, 2)
                    )
                }

                // 绘制所有的圆
                function render() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height)
                    for (let k = 0; k < num; k++) {
                        ctx.save()
                        ctx.beginPath()
                        ctx.arc(balls[k].x, balls[k].y, balls[k].r, 0, Math.PI * 2)
                        ctx.fillStyle = balls[k].fillColor
                        ctx.fill()
                        ctx.restore()
                    }

                    // 遍历每两个圆的圆心之间的距离是否小于某个临界值（比如500），满足则将这两个圆的圆心连接起来
                    for (var i = 0; i < num; i++) {
                        for (var j = i + 1; j < num; j++) {
                            if (distance(balls[i], balls[j]) < 300) {
                                ctx.beginPath()
                                ctx.moveTo(balls[i].x, balls[i].y)
                                ctx.lineTo(balls[j].x, balls[j].y)
                                ctx.stroke()
                            }
                        }
                    }

                    // 判断圆是否超出了边界值，若满足条件则从对边再次进来
                    for (var k = 0; k < num; k++) {
                        balls[k].x += balls[k].vx
                        balls[k].y += balls[k].vy

                        if (balls[k].x - balls[k].r > canvas.width) {
                            balls[k].x = 0 - balls[k].r
                        }
                        if (balls[k].x + balls[k].r < 0) {
                            balls[k].x = canvas.width + balls[k].r
                        }
                        if (balls[k].y - balls[k].r > canvas.height) {
                            balls[k].y = 0 - balls[k].r
                        }
                        if (balls[k].y + balls[k].r < 0) {
                            balls[k].y = canvas.height + balls[k].r
                        }
                    }
                }

                ;(function loop() {
                    render()
                    requestAnimationFrame(loop)
                })()
            })
        </script>
    </body>
</html>
