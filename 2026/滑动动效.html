<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="viewport"
            content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
        />
        <meta content="telephone=no" name="format-detection" />
        <title>Document</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            html,
            body {
                width: 100%;
                height: 100%;
                overflow: hidden;
                background: #f0f0f0;
            }

            .list {
                position: relative;
                height: 15px;
                display: flex;
                gap: 6px;
                list-style: none;
                margin: 100px;
            }
            .item {
                position: relative;
                width: 2px;
                height: 15px;
                background: #a0a0a0;
                transition: all 0.2s ease;
            }
            .item.active {
                transform: scaleY(1.7);
                transform-origin: center bottom;
                background: #1d1e1e;
            }
            .item.sub-1 {
                transform: scaleY(1.4);
                transform-origin: center bottom;
                background: #4a4a4a;
            }
            .item.sub-2 {
                transform: scaleY(1.2);
                transform-origin: center bottom;
                background: #6a6a6a;
            }

            .triangle {
                position: absolute;
                top: -30px !important;
                width: 0;
                height: 0;
                border-left: 6px solid transparent;
                border-right: 6px solid transparent;
                border-top: 8px solid #474747;
                transition: all 0.2s ease;
                opacity: 0;
            }
            .triangle.show {
                opacity: 1;
            }
        </style>
    </head>
    <body>
        <div class="wrap">
            <ul class="list">
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
                <li class="item"></li>
            </ul>
        </div>
        <script>
            const list = document.querySelector('.list');
            const items = document.querySelectorAll('.item');

            // 创建三角形指示器
            const triangle = document.createElement('div');
            triangle.className = 'triangle';
            list.appendChild(triangle);

            // 查找最近的 item
            const findClosestItem = (x, y) => {
                let closestItem = null;
                let minDistance = Infinity;

                items.forEach((item) => {
                    const rect = item.getBoundingClientRect();
                    const itemCenterX = rect.left + rect.width / 2;
                    const itemCenterY = rect.top + rect.height / 2;

                    // 计算距离
                    const distance = Math.sqrt(Math.pow(x - itemCenterX, 2) + Math.pow(y - itemCenterY, 2));

                    if (distance < minDistance) {
                        minDistance = distance;
                        closestItem = item;
                    }
                });

                return closestItem;
            };

            // 更新激活状态和三角形位置
            const updateActiveItem = (x, y) => {
                const closestItem = findClosestItem(x, y);

                if (closestItem) {
                    // 移除所有类名
                    items.forEach((item) => {
                        item.classList.remove('active', 'sub-1', 'sub-2');
                    });

                    // 找到激活元素的索引
                    const itemsArray = Array.from(items);
                    const activeIndex = itemsArray.indexOf(closestItem);

                    // 添加 active 类到最近的 item
                    closestItem.classList.add('active');

                    // 添加 sub-1 类到左右相邻元素
                    if (activeIndex > 0) {
                        itemsArray[activeIndex - 1].classList.add('sub-1');
                    }
                    if (activeIndex < itemsArray.length - 1) {
                        itemsArray[activeIndex + 1].classList.add('sub-1');
                    }

                    // 添加 sub-2 类到左右隔一个的元素
                    if (activeIndex > 1) {
                        itemsArray[activeIndex - 2].classList.add('sub-2');
                    }
                    if (activeIndex < itemsArray.length - 2) {
                        itemsArray[activeIndex + 2].classList.add('sub-2');
                    }

                    // 定位三角形
                    const itemRect = closestItem.getBoundingClientRect();
                    const listRect = list.getBoundingClientRect();

                    const triangleLeft = itemRect.left - listRect.left + itemRect.width / 2 - 6;
                    const triangleTop = itemRect.top - listRect.top - 12;

                    triangle.style.left = `${triangleLeft}px`;
                    triangle.style.top = `${triangleTop}px`;
                    triangle.classList.add('show');
                }
            };

            // 监听触摸事件（移动端）
            list.addEventListener('touchstart', (e) => {
                const touch = e.touches[0];
                updateActiveItem(touch.clientX, touch.clientY);
            });

            list.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                updateActiveItem(touch.clientX, touch.clientY);
            });

            list.addEventListener('touchend', () => {
                // 可选：触摸结束后移除激活状态
                // items.forEach(item => item.classList.remove('active', 'sub-1', 'sub-2'));
                // triangle.classList.remove('show');
            });
        </script>
    </body>
</html>
